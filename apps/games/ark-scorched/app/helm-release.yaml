apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: ark-scorched
  namespace: games
spec:
  interval: 5m
  timeout: 30m
  chart:
    spec:
      chart: ./charts/ark-sa
      sourceRef:
        kind: GitRepository
        name: flux-system
        namespace: flux-system
  valuesFrom:
    - kind: ConfigMap
      name: game-config
      valuesKey: ark_scorched_lb_ip
      targetPath: spec.values.service.loadBalancerIP
      optional: false
    - kind: ConfigMap
      name: game-config
      valuesKey: RCON_PASSWORD
      targetPath: spec.values.server.adminPassword
      optional: false
    - kind: ConfigMap
      name: game-config
      valuesKey: GAME_PASSWORD
      targetPath: spec.values.server.password
      optional: false
  values:
    server:
      name: "Venture-Bros-Scorched"
      map: ScorchedEarth_WP
      clusterID: venturecluster
      mods: [950914, 935408]  # Awesome Teleporters!, Der Dino Finder
    service:
      type: LoadBalancer
      gamePort: 7777
      peerPort: 7778
      queryPort: 27015
    persistence:
      ark:
        existingClaim: ark-scorched-game
      cluster:
        existingClaim: ark-cluster-shared
      steamcmd:
        existingClaim: ark-steamcmd-shared
    resources:
      limits:
        memory: 20Gi
      requests:
        memory: 10Gi
    podOptions:
      hostNetwork: true
